<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Elite 12.0 - Nuvem</title>
    <style>
        :root { --primary: #2563eb; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card-bg: #ffffff; --text: #1e293b; --border: #e2e8f0; --accent: #f59e0b; }
        [data-theme="dark"] { --bg: #0f172a; --card-bg: #1e293b; --text: #f8fafc; --border: #334155; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; transition: 0.3s; min-height: 100vh; }
        .section { background: var(--card-bg); padding: 20px; border-radius: 12px; border: 1px solid var(--border); width: 100%; max-width: 550px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn { padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; color: white; transition: 0.2s; font-size: 0.8rem; }
        .btn-ghost { background: transparent; color: var(--primary); border: 1px solid var(--primary); padding: 5px 10px; margin: 2px; }
        .flashcard-container { perspective: 1000px; width: 100%; height: 260px; cursor: pointer; margin: 15px 0; }
        .flashcard { position: relative; width: 100%; height: 100%; transition: transform 0.4s; transform-style: preserve-3d; }
        .flashcard.flipped { transform: rotateY(180deg); }
        .front, .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; padding: 25px; border-radius: 15px; border: 2px solid var(--primary); box-sizing: border-box; text-align: center; background: var(--card-bg); }
        .back { background: var(--primary); color: white; transform: rotateY(180deg); }
        input, select, textarea { width: 100%; padding: 10px; margin-bottom: 8px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text); box-sizing: border-box; }
        .status-nuvem { font-size: 0.7rem; color: var(--success); margin-bottom: 10px; font-weight: bold; text-align: center; }
    </style>
</head>
<body class="theme-default">

    <div class="section" style="text-align: center;">
        <div id="cloudStatus" class="status-nuvem">‚òÅÔ∏è Conectando √† nuvem...</div>
        <button class="btn btn-ghost" onclick="toggleTheme()">üåô Tema</button>
        <button class="btn btn-ghost" onclick="loadFromCloud()">üîÑ Sincronizar Agora</button>
    </div>

    <div class="section">
        <select id="topicSelect" onchange="updateSubtopics()"></select>
        <select id="subtopicSelect" onchange="loadCards()"></select>
        
        <div class="flashcard-container" onclick="flipCard()">
            <div class="flashcard" id="cardElement">
                <div class="front" id="cardFront">Carregando...</div>
                <div class="back" id="cardBack">Verso</div>
            </div>
        </div>

        <div style="display:flex; gap:10px;">
            <button class="btn" style="background:var(--danger); flex:1" onclick="markCard(false)">‚úò ERREI</button>
            <button class="btn" style="background:var(--success); flex:1" onclick="markCard(true)">‚úî ACERTEI</button>
        </div>
    </div>

    <div class="section">
        <h2 style="font-size: 0.9rem; margin-bottom: 10px;">üì• Importar</h2>
        <input type="text" id="impTopic" placeholder="Mat√©ria">
        <input type="text" id="impSub" placeholder="Assunto">
        <textarea id="bulkArea" placeholder="Frente | Verso" style="height:50px;"></textarea>
        <button class="btn" style="background:var(--primary); width:100%" onclick="importBulk()">Salvar na Nuvem</button>
    </div>

    <script>
        // === CONFIGURA√á√ÉO FINAL DA SUA NUVEM ===
        const BIN_ID = "697d6d7bd0ea881f4094c919"; 
        const API_KEY = "$2a$10$7iw3IV/n.0zuX9HXibgvWOj.DgsxDOnI5mzuir48jgQZui9EJPLlG";
        // =======================================

        let database = {}, reviewList = {}, subjectStats = {}, cardErrors = {};
        let filteredCards = [], currentIndex = 0;

        async function syncToCloud() {
            document.getElementById('cloudStatus').innerText = "‚òÅÔ∏è Salvando...";
            const data = { database, reviewList, subjectStats, cardErrors };
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: { 
                        'Content-Type': 'application/json', 
                        'X-Master-Key': API_KEY 
                    },
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    document.getElementById('cloudStatus').innerText = "‚úÖ Sincronizado";
                } else {
                    document.getElementById('cloudStatus').innerText = "‚ùå Erro ao salvar";
                }
            } catch (e) { 
                document.getElementById('cloudStatus').innerText = "‚ùå Sem conex√£o"; 
            }
        }

        async function loadFromCloud() {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': API_KEY }
                });
                const result = await res.json();
                const d = result.record;
                
                database = d.database || {};
                reviewList = d.reviewList || {};
                subjectStats = d.subjectStats || {};
                cardErrors = d.cardErrors || {};
                
                renderMenus();
                document.getElementById('cloudStatus').innerText = "‚úÖ Nuvem Ativa";
            } catch (e) { 
                document.getElementById('cloudStatus').innerText = "‚ùå Erro ao carregar"; 
            }
        }

        function importBulk() {
            const t = document.getElementById('impTopic').value.trim();
            const s = document.getElementById('impSub').value.trim();
            const text = document.getElementById('bulkArea').value.trim();
            
            if(!t || !s || !text) return;
            
            if(!database[t]) database[t] = {}; 
            if(!database[t][s]) database[t][s] = [];
            
            text.split('\n').forEach(line => {
                const p = line.split('|');
                if(p.length === 2) {
                    database[t][s].push({ 
                        f: p[0].trim(), 
                        v: p[1].trim(), 
                        id: Date.now() + Math.random() 
                    });
                }
            });
            
            renderMenus();
            syncToCloud(); 
            document.getElementById('bulkArea').value = "";
        }

        function renderMenus() {
            const sel = document.getElementById('topicSelect'); 
            sel.innerHTML = "";
            Object.keys(database).forEach(t => { 
                let o = document.createElement('option'); 
                o.value = o.innerText = t; 
                sel.appendChild(o); 
            });
            updateSubtopics();
        }

        function updateSubtopics() {
            const t = document.getElementById('topicSelect').value;
            const sel = document.getElementById('subtopicSelect');
            sel.innerHTML = "";
            if(t && database[t]) {
                Object.keys(database[t]).forEach(s => { 
                    let o = document.createElement('option'); 
                    o.value = o.innerText = s; 
                    sel.appendChild(o); 
                });
            }
            loadCards();
        }

        function loadCards() {
            const t = document.getElementById('topicSelect').value;
            const s = document.getElementById('subtopicSelect').value;
            filteredCards = (t && s && database[t][s]) ? [...database[t][s]] : [];
            currentIndex = 0; 
            showCard();
        }

        function showCard() {
            document.getElementById('cardElement').classList.remove('flipped');
            if(filteredCards.length > 0 && filteredCards[currentIndex]) {
                document.getElementById('cardFront').innerText = filteredCards[currentIndex].f;
                document.getElementById('cardBack').innerText = filteredCards[currentIndex].v;
            } else { 
                document.getElementById('cardFront').innerText = "Nenhum card encontrado"; 
            }
        }

        function markCard(isSuccess) {
            if (filteredCards.length === 0) return;
            
            currentIndex++;
            if (currentIndex >= filteredCards.length) { 
                alert("Voc√™ completou este assunto!"); 
                currentIndex = 0; 
            }
            
            showCard();
            // Salva na nuvem o fato de que voc√™ avan√ßou (ou se houver stats futuras)
            syncToCloud();
        }

        function flipCard() { document.getElementById('cardElement').classList.toggle('flipped'); }
        function toggleTheme() { 
            const current = document.documentElement.getAttribute('data-theme');
            document.documentElement.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark'); 
        }
        
        // Inicia carregando da nuvem automaticamente
        window.onload = loadFromCloud;
    </script>
</body>
</html>